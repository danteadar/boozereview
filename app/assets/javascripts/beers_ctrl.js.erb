(function() {
  "use strict";

  angular.module("app").controller("beersCtrl", function($scope, $http) {
    // $scope.message = "hello world";

    $scope.setup = function() {
      // console.log("cat");
      $http.get("/api/v1/reviews.json").then(function(response) {
        $scope.reviews = response.data;
      });
      $http.get("https://api.brewerydb.com/v2/beers/?key="+"<%=ENV['BREWERYDB_API_KEY']%>"+"&withBreweries=Y").then(function(response) {
        $scope.beers = response.data.data;
        $scope.beerCount = $scope.beers.length

      }); 
    };

    $scope.apiSearch = function(keyword) {
      // console.log("cat");  lookup ng-if cat example
      $http.get("https://api.brewerydb.com/v2/beers/?key="+"<%=ENV['BREWERYDB_API_KEY']%>"+"&withBreweries=Y"+"&name=*"+keyword+"*").then(function(response) {
        $scope.beers = response.data.data;
        $scope.beerCount = $scope.beers.length
      });
    };
    $scope.getReviews = function(apiBeerId) {
        $http.get("/api/v1/reviews.json?api_beer_id=" + apiBeerId).then(function(response) {
        $scope.reviews = response.data;
      });
    }
    $scope.findByApiId = function(apiBeerId) {
      console.log(apiBeerId);

      $http.get("https://api.brewerydb.com/v2/beer/"+apiBeerId+"/?key="+"<%=ENV['BREWERYDB_API_KEY']%>&withBreweries=Y").then(function(response) {
        $scope.beerReviewed = response.data.data;
      });
    };
  }); 
}());

